#!/usr/bin/env python3
# -*- coding:utf-8 -*-

import socket

import time
import random
import struct
import io
import sys

sys.path.append('./')
from rtmp.Client import Client

if __name__ == '__main__':
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    sock.connect(('localhost', 1935))
    rtmp = Client(sock)
    rtmp.do_handshake()
    rtmp.do_connect()

    if sys.argv[1] == 'play':
        rtmp.do_play()
        # TODO recv loop
    elif sys.argv[1] == 'publish':
        rtmp.do_set_chunk_size(sock,32767)
        rtmp.do_createstream()
        rtmp.do_publish()
        fd = open('/Users/hiroki/Downloads/test.jpg', 'rb')
        while(True):
            data = fd.read(32767)
            if len(data) == 0:
                break
            rtmp.do_send_anydata(data)
    sock.close()
